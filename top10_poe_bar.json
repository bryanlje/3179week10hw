{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Top 10 points of entry (POE) by total arrivals for a selected year; bars colored by entry type (Land/Sea/Air).",
  "width": "container",
  "height": 440,
  "data": {
    "url": "https://raw.githubusercontent.com/bryanlje/3179week9hw/main/arrivals_record.csv",
    "format": {
      "type": "csv"
    }
  },
  "params": [
    {
      "name": "yearSel",
      "value": 2023,
      "bind": {
        "input": "select",
        "name": "Year: ",
        "options": [
          2020,
          2021,
          2022,
          2023
        ]
      }
    }
  ],
  "transform": [
    {
      "calculate": "year(toDate(datum.date))",
      "as": "Year"
    },
    {
      "aggregate": [
        {
          "op": "sum",
          "field": "arrivals",
          "as": "TotalArrivals"
        }
      ],
      "groupby": [
        "Year",
        "poe"
      ]
    },
    {
      "lookup": "poe",
      "from": {
        "data": {
          "url": "https://raw.githubusercontent.com/bryanlje/3179week9hw/main/points_of_entry.csv",
          "format": {
            "type": "csv"
          }
        },
        "key": "poe",
        "fields": [
          "type"
        ]
      }
    },
    {
      "filter": "datum.Year == yearSel"
    },
    {
      "window": [
        {
          "op": "rank",
          "as": "rank"
        }
      ],
      "sort": [
        {
          "field": "TotalArrivals",
          "order": "descending"
        }
      ],
      "groupby": [
        "Year"
      ]
    },
    {
      "filter": "datum.rank <= 10"
    }
  ],
  "mark": {
    "type": "bar"
  },
  "encoding": {
    "y": {
      "field": "poe",
      "type": "nominal",
      "title": "Point of Entry",
      "sort": "-x"
    },
    "x": {
      "field": "TotalArrivals",
      "type": "quantitative",
      "title": "Total Arrivals",
      "axis": {
        "format": "~s"
      }
    },
    "color": {
      "field": "type",
      "type": "nominal",
      "title": "Entry Type",
      "scale": {
        "domain": [
          "Land",
          "Sea",
          "Air"
        ],
        "range": ["#E69F00", "#3da7d4", "#008a57"] 
      }
    },
    "tooltip": [
      {
        "field": "poe",
        "type": "nominal",
        "title": "Point of Entry"
      },
      {
        "field": "type",
        "type": "nominal",
        "title": "Entry Type"
      },
      {
        "field": "Year",
        "type": "quantitative"
      },
      {
        "field": "TotalArrivals",
        "type": "quantitative",
        "format": ",",
        "title": "Arrivals"
      }
    ]
  },
  "config": {
    "view": {
      "stroke": "transparent"
    },
    "axis": {
      "labelFontSize": 12,
      "titleFontSize": 12
    },
    "bar": {
      "cornerRadiusEnd": 2
    }
  }
}